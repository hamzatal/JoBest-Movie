services:
  # 1.  (PostgreSQL)
  - type: pserv 
    name: movie-db
    plan: free
    databaseName: moviedb 
    region: oregon
    
  # 2. (Laravel/Inertia)
  - type: web
    name: movie-app
    plan: free # الخطة المجانية
    region: oregon # يجب أن تكون نفس منطقة قاعدة البيانات
    buildCommand: |
      composer install --no-dev --prefer-dist
      npm install
      npm run build
    startCommand: php artisan serve --host=0.0.0.0
    env: static
    rootDir: .
    
    # متغيرات البيئة (Environment Variables)
    envVars:
      - key: APP_KEY
        generateValue: true
      - key: APP_ENV
        value: production
      - key: APP_DEBUG
        value: false
      - key: DB_CONNECTION
        value: pgsql
      - key: DB_HOST
        value: ${movie-db.internalHostname} # ربط داخلي بقاعدة البيانات
      - key: DB_DATABASE
        value: jobest
      - key: DB_USERNAME
        value: jobest
      - key: DB_PASSWORD
        generateValue: true
      - key: TMDB_API_KEY
        value: YOUR_TMDB_API_KEY_HERE # لا تنس تغيير هذا
      - key: VITE_APP_URL
        value: https://jobest.onrender.com # سيتم تحديث هذا تلقائيًا بعد النشر
      - key: WEB_CONCURRENCY
        value: 1
      
    # أوامر ما بعد النشر (لإعداد قاعدة البيانات )
    autoDeploy: true
    healthCheckPath: /
    
    # أمر التشغيل بعد البناء
    preDeployCommand: |
      php artisan migrate --force
