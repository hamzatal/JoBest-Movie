# render.yaml - الكود المصحح
services:
  # 1. خدمة قاعدة البيانات (PostgreSQL) - تم تغيير type: pserv إلى type: database
  - type: database 
    name: movie-db
    plan: free
    databaseName: moviedb 
    region: oregon
    
  # 2. خدمة الويب (Laravel/Inertia)
  - type: web
    name: movie-app
    plan: free
    region: oregon
    
    # يجب أن يكون هذا السطر موجودًا في ملف .env لديك
    # VITE_APP_URL سيتم تحديثه تلقائيًا
    
    buildCommand: |
      composer install --no-dev --prefer-dist
      npm install
      npm run build
      
    startCommand: php artisan serve --host=0.0.0.0
    env: static
    rootDir: .
    
    # متغيرات البيئة (Environment Variables)
    envVars:
      - key: APP_KEY
        generateValue: true
      - key: APP_ENV
        value: production
      - key: APP_DEBUG
        value: false
      - key: DB_CONNECTION
        value: pgsql
      - key: DB_HOST
        value: ${movie-db.internalHostname}
      - key: DB_DATABASE
        value: moviedb # يجب أن يتطابق مع databaseName أعلاه
      - key: DB_USERNAME
        value: moviedb # يجب أن يتطابق مع databaseName أعلاه
      - key: DB_PASSWORD
        generateValue: true
      - key: TMDB_API_KEY
        value: YOUR_TMDB_API_KEY_HERE
      - key: WEB_CONCURRENCY
        value: 1
      
    # أمر التشغيل قبل النشر
    preDeployCommand: |
      php artisan migrate --force
